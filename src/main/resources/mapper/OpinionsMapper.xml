<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dao.OpinionsMapper">
	<resultMap id="BaseResultMap" type="com.bean.Opinions">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		<constructor>
			<idArg column="id" javaType="java.lang.Integer" jdbcType="INTEGER" />
			<arg column="content" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="star" javaType="java.lang.Integer" jdbcType="INTEGER" />
			<arg column="pid" javaType="java.lang.Integer" jdbcType="INTEGER" />
			<arg column="uid" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="opinionstime" javaType="java.util.Date" jdbcType="DATE" />
			<arg column="extended1" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="extended2" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="extended3" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="extended4" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="extended5" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="extended6" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="extended7" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="extended8" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="extended9" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="extended10" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="extended11" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="extended12" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="extended13" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="extended14" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="extended15" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="extended16" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="extended17" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="extended18" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="extended19" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="extended20" javaType="java.lang.String" jdbcType="VARCHAR" />
		</constructor>
	</resultMap>
	<sql id="Base_Column_List">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		id, content, star, pid, uid, opinionstime, extended1, extended2,
		extended3, extended4,
		extended5, extended6, extended7, extended8, extended9, extended10, extended11,
		extended12,
		extended13, extended14, extended15, extended16, extended17, extended18,
		extended19,
		extended20
	</sql>
	<select id="selectByPrimaryKey" parameterType="java.lang.Integer"
		resultMap="BaseResultMap">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		select
		<include refid="Base_Column_List" />
		from opinions
		where id = #{id,jdbcType=INTEGER}
	</select>
	<delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		delete from opinions
		where id = #{id,jdbcType=INTEGER}
	</delete>
	<insert id="insert" parameterType="com.bean.Opinions">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		insert into opinions (id, content, star,
		pid, uid, opinionstime,
		extended1, extended2, extended3,
		extended4, extended5, extended6,
		extended7, extended8, extended9,
		extended10, extended11, extended12,
		extended13, extended14, extended15,
		extended16, extended17, extended18,
		extended19, extended20)
		values (#{id,jdbcType=INTEGER}, #{content,jdbcType=VARCHAR},
		#{star,jdbcType=INTEGER},
		#{pid,jdbcType=INTEGER}, #{uid,jdbcType=VARCHAR}, #{opinionstime,jdbcType=DATE},
		#{extended1,jdbcType=VARCHAR}, #{extended2,jdbcType=VARCHAR},
		#{extended3,jdbcType=VARCHAR},
		#{extended4,jdbcType=VARCHAR}, #{extended5,jdbcType=VARCHAR}, #{extended6,jdbcType=VARCHAR},
		#{extended7,jdbcType=VARCHAR}, #{extended8,jdbcType=VARCHAR},
		#{extended9,jdbcType=VARCHAR},
		#{extended10,jdbcType=VARCHAR}, #{extended11,jdbcType=VARCHAR}, #{extended12,jdbcType=VARCHAR},
		#{extended13,jdbcType=VARCHAR}, #{extended14,jdbcType=VARCHAR},
		#{extended15,jdbcType=VARCHAR},
		#{extended16,jdbcType=VARCHAR}, #{extended17,jdbcType=VARCHAR}, #{extended18,jdbcType=VARCHAR},
		#{extended19,jdbcType=VARCHAR}, #{extended20,jdbcType=VARCHAR})
	</insert>
	<insert id="insertSelective"  useGeneratedKeys="true"
		keyProperty="id"  parameterType="com.bean.Opinions">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		insert into opinions
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="id != null">
				id,
			</if>
			<if test="content != null">
				content,
			</if>
			<if test="star != null">
				star,
			</if>
			<if test="pid != null">
				pid,
			</if>
			<if test="uid != null">
				uid,
			</if>
			<if test="opinionstime != null">
				opinionstime,
			</if>
			<if test="extended1 != null">
				extended1,
			</if>
			<if test="extended2 != null">
				extended2,
			</if>
			<if test="extended3 != null">
				extended3,
			</if>
			<if test="extended4 != null">
				extended4,
			</if>
			<if test="extended5 != null">
				extended5,
			</if>
			<if test="extended6 != null">
				extended6,
			</if>
			<if test="extended7 != null">
				extended7,
			</if>
			<if test="extended8 != null">
				extended8,
			</if>
			<if test="extended9 != null">
				extended9,
			</if>
			<if test="extended10 != null">
				extended10,
			</if>
			<if test="extended11 != null">
				extended11,
			</if>
			<if test="extended12 != null">
				extended12,
			</if>
			<if test="extended13 != null">
				extended13,
			</if>
			<if test="extended14 != null">
				extended14,
			</if>
			<if test="extended15 != null">
				extended15,
			</if>
			<if test="extended16 != null">
				extended16,
			</if>
			<if test="extended17 != null">
				extended17,
			</if>
			<if test="extended18 != null">
				extended18,
			</if>
			<if test="extended19 != null">
				extended19,
			</if>
			<if test="extended20 != null">
				extended20,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="id != null">
				#{id,jdbcType=INTEGER},
			</if>
			<if test="content != null">
				#{content,jdbcType=VARCHAR},
			</if>
			<if test="star != null">
				#{star,jdbcType=INTEGER},
			</if>
			<if test="pid != null">
				#{pid,jdbcType=INTEGER},
			</if>
			<if test="uid != null">
				#{uid,jdbcType=VARCHAR},
			</if>
			<if test="opinionstime != null">
				#{opinionstime,jdbcType=DATE},
			</if>
			<if test="extended1 != null">
				#{extended1,jdbcType=VARCHAR},
			</if>
			<if test="extended2 != null">
				#{extended2,jdbcType=VARCHAR},
			</if>
			<if test="extended3 != null">
				#{extended3,jdbcType=VARCHAR},
			</if>
			<if test="extended4 != null">
				#{extended4,jdbcType=VARCHAR},
			</if>
			<if test="extended5 != null">
				#{extended5,jdbcType=VARCHAR},
			</if>
			<if test="extended6 != null">
				#{extended6,jdbcType=VARCHAR},
			</if>
			<if test="extended7 != null">
				#{extended7,jdbcType=VARCHAR},
			</if>
			<if test="extended8 != null">
				#{extended8,jdbcType=VARCHAR},
			</if>
			<if test="extended9 != null">
				#{extended9,jdbcType=VARCHAR},
			</if>
			<if test="extended10 != null">
				#{extended10,jdbcType=VARCHAR},
			</if>
			<if test="extended11 != null">
				#{extended11,jdbcType=VARCHAR},
			</if>
			<if test="extended12 != null">
				#{extended12,jdbcType=VARCHAR},
			</if>
			<if test="extended13 != null">
				#{extended13,jdbcType=VARCHAR},
			</if>
			<if test="extended14 != null">
				#{extended14,jdbcType=VARCHAR},
			</if>
			<if test="extended15 != null">
				#{extended15,jdbcType=VARCHAR},
			</if>
			<if test="extended16 != null">
				#{extended16,jdbcType=VARCHAR},
			</if>
			<if test="extended17 != null">
				#{extended17,jdbcType=VARCHAR},
			</if>
			<if test="extended18 != null">
				#{extended18,jdbcType=VARCHAR},
			</if>
			<if test="extended19 != null">
				#{extended19,jdbcType=VARCHAR},
			</if>
			<if test="extended20 != null">
				#{extended20,jdbcType=VARCHAR},
			</if>
		</trim>
	</insert>
	<update id="updateByPrimaryKeySelective" parameterType="com.bean.Opinions">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		update opinions
		<set>
			<if test="content != null">
				content = #{content,jdbcType=VARCHAR},
			</if>
			<if test="star != null">
				star = #{star,jdbcType=INTEGER},
			</if>
			<if test="pid != null">
				pid = #{pid,jdbcType=INTEGER},
			</if>
			<if test="uid != null">
				uid = #{uid,jdbcType=VARCHAR},
			</if>
			<if test="opinionstime != null">
				opinionstime = #{opinionstime,jdbcType=DATE},
			</if>
			<if test="extended1 != null">
				extended1 = #{extended1,jdbcType=VARCHAR},
			</if>
			<if test="extended2 != null">
				extended2 = #{extended2,jdbcType=VARCHAR},
			</if>
			<if test="extended3 != null">
				extended3 = #{extended3,jdbcType=VARCHAR},
			</if>
			<if test="extended4 != null">
				extended4 = #{extended4,jdbcType=VARCHAR},
			</if>
			<if test="extended5 != null">
				extended5 = #{extended5,jdbcType=VARCHAR},
			</if>
			<if test="extended6 != null">
				extended6 = #{extended6,jdbcType=VARCHAR},
			</if>
			<if test="extended7 != null">
				extended7 = #{extended7,jdbcType=VARCHAR},
			</if>
			<if test="extended8 != null">
				extended8 = #{extended8,jdbcType=VARCHAR},
			</if>
			<if test="extended9 != null">
				extended9 = #{extended9,jdbcType=VARCHAR},
			</if>
			<if test="extended10 != null">
				extended10 = #{extended10,jdbcType=VARCHAR},
			</if>
			<if test="extended11 != null">
				extended11 = #{extended11,jdbcType=VARCHAR},
			</if>
			<if test="extended12 != null">
				extended12 = #{extended12,jdbcType=VARCHAR},
			</if>
			<if test="extended13 != null">
				extended13 = #{extended13,jdbcType=VARCHAR},
			</if>
			<if test="extended14 != null">
				extended14 = #{extended14,jdbcType=VARCHAR},
			</if>
			<if test="extended15 != null">
				extended15 = #{extended15,jdbcType=VARCHAR},
			</if>
			<if test="extended16 != null">
				extended16 = #{extended16,jdbcType=VARCHAR},
			</if>
			<if test="extended17 != null">
				extended17 = #{extended17,jdbcType=VARCHAR},
			</if>
			<if test="extended18 != null">
				extended18 = #{extended18,jdbcType=VARCHAR},
			</if>
			<if test="extended19 != null">
				extended19 = #{extended19,jdbcType=VARCHAR},
			</if>
			<if test="extended20 != null">
				extended20 = #{extended20,jdbcType=VARCHAR},
			</if>
		</set>
		where id = #{id,jdbcType=INTEGER}
	</update>
	<update id="updateByPrimaryKey" parameterType="com.bean.Opinions">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		update opinions
		set content = #{content,jdbcType=VARCHAR},
		star = #{star,jdbcType=INTEGER},
		pid = #{pid,jdbcType=INTEGER},
		uid = #{uid,jdbcType=VARCHAR},
		opinionstime = #{opinionstime,jdbcType=DATE},
		extended1 = #{extended1,jdbcType=VARCHAR},
		extended2 = #{extended2,jdbcType=VARCHAR},
		extended3 = #{extended3,jdbcType=VARCHAR},
		extended4 = #{extended4,jdbcType=VARCHAR},
		extended5 = #{extended5,jdbcType=VARCHAR},
		extended6 = #{extended6,jdbcType=VARCHAR},
		extended7 = #{extended7,jdbcType=VARCHAR},
		extended8 = #{extended8,jdbcType=VARCHAR},
		extended9 = #{extended9,jdbcType=VARCHAR},
		extended10 = #{extended10,jdbcType=VARCHAR},
		extended11 = #{extended11,jdbcType=VARCHAR},
		extended12 = #{extended12,jdbcType=VARCHAR},
		extended13 = #{extended13,jdbcType=VARCHAR},
		extended14 = #{extended14,jdbcType=VARCHAR},
		extended15 = #{extended15,jdbcType=VARCHAR},
		extended16 = #{extended16,jdbcType=VARCHAR},
		extended17 = #{extended17,jdbcType=VARCHAR},
		extended18 = #{extended18,jdbcType=VARCHAR},
		extended19 = #{extended19,jdbcType=VARCHAR},
		extended20 = #{extended20,jdbcType=VARCHAR}
		where id = #{id,jdbcType=INTEGER}
	</update>

	<!-- 关联查询 -->
	<resultMap id="OpinionsOldUserAndProduct" type="com.bean.Opinions">
		<id column="id" property="id" />
		<result column="content" property="content" />
		<result column="star" property="star" />
		<result column="pid" property="pid" />
		<result column="uid" property="uid" />
		<result column="opinionstime" property="opinionstime" />
		<association javaType="com.bean.Products" property="products">
			<id column="idp" property="id" />
			<result column="pname" property="pname" />
			<result column="size" property="size" />
			<result column="productscolor" property="productscolor" />
			<result column="productstype1" property="productstype1" />
			<result column="productstype2" property="productstype2" />
			<result column="price" property="price" />
			<result column="pdescription" property="pdescription" />
			<result column="count" property="count" />
			<result column="tid" property="tid" />
		</association>
		<association javaType="com.bean.OldUsers" property="oldUsers">
			<id column="idu" property="id" />
			<result column="username" property="username" />
			<result column="sex" property="sex" />
			<result column="idcard" property="idcard" />
			<result column="birthday" property="birthday" />
			<result column="tell" property="tell" />
			<result column="address" property="address" />
			<result column="area" property="area" />
			<result column="uid" property="uid" />
			<result column="password" property="password" />
			<result column="userurl" property="userurl" />
			<result column="balance" property="balance" />
			<result column="type" property="type" />
		</association>
	</resultMap>


	<!-- 关联查询 -->
	<select id="selectByPidOpinions" parameterType="hashMap"
		resultMap="OpinionsOldUserAndProduct">
		select * from opinions o,products p,old_users u
		where p.id=o.pid and
		o.uid=u.uid and o.pid=#{pid}
		order by opinionstime DESC
		limit #{page},#{max}
	</select>

	<select id="selectByPidOpinionsCount" parameterType="hashMap"
		resultType="java.lang.Integer">
		select count(*) from opinions where pid=#{pid}
	</select>
	<select id="selectByPidOpinionsAvg" parameterType="java.lang.Integer"
		resultType="java.lang.Double">
		select COALESCE(avg(star),0) from opinions where pid=#{pid}
	</select>
	
	<!-- 查询用户评论 -->
	<select id="selectByUidOpinions" parameterType="hashMap"
		resultMap="OpinionsOldUserAndProduct">
		select * from opinions o,products p,old_users u
		where p.id=o.pid and
		o.uid=u.uid and o.uid=#{uid}
		order by opinionstime DESC
	</select>
	
	

</mapper>